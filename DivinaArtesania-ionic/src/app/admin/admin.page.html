<ion-header class="ion-no-border">
  <ion-toolbar color="dark">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/home"></ion-back-button>
    </ion-buttons>
    <ion-title style="font-weight: 700;">ADMINISTRACIÓN</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="cargarProductos()">
        <ion-icon slot="icon-only" name="refresh-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>

  <ion-toolbar color="dark">
    <ion-searchbar 
      placeholder="Buscar por nombre o categoría..." 
      (ionInput)="buscarProducto($event)" 
      animated="true"
      style="--background: #333; --color: #fff;">
    </ion-searchbar>
  </ion-toolbar>
</ion-header>

<ion-content color="light">
  <ion-list lines="none" style="background: transparent;">
    <ion-card *ngFor="let p of productosFiltrados" style="margin: 12px; border-radius: 16px; position: relative;">
      
      <ion-item lines="none">
        <ion-thumbnail slot="start" (click)="fotoInput.click()" style="cursor: pointer; position: relative; width: 64px; height: 64px;">
          <img [src]="p.imagen" style="border-radius: 10px; object-fit: cover;" />
          <div style="position: absolute; bottom: 0; right: 0; background: rgba(0,0,0,0.6); border-radius: 50%; padding: 4px;">
            <ion-icon name="camera-outline" style="color: white; font-size: 14px;"></ion-icon>
          </div>
          <input #fotoInput type="file" (change)="seleccionarImagen($event, p)" style="display: none;" accept="image/*">
        </ion-thumbnail>

        <ion-label>
          <ion-input style="font-weight: 700; font-size: 1.1em;" [(ngModel)]="p.nombre" placeholder="Nombre"></ion-input>
          <ion-select [(ngModel)]="p.categoria" interface="popover"
                      style="font-size: 0.85em; color: #666; margin-top: 4px;">
            <ion-select-option value="CERAMICA">Cerámica</ion-select-option>
            <ion-select-option value="TEJIDOS">Tejidos</ion-select-option>
            <ion-select-option value="MADERA">Madera</ion-select-option>
            <ion-select-option value="OTRO">Otro</ion-select-option>
          </ion-select>
        </ion-label>

        <ion-button slot="end" fill="clear" color="danger" (click)="eliminarProducto(p)">
          <ion-icon name="trash-outline"></ion-icon>
        </ion-button>
      </ion-item>

      <ion-card-content>
        <ion-row>
          <ion-col size="5">
            <ion-item fill="outline" style="--border-radius: 12px; --padding-start: 8px;">
              <ion-label position="floating">Precio ($)</ion-label>
              <ion-input type="number" [(ngModel)]="p.precio"></ion-input>
            </ion-item>
          </ion-col>

          <ion-col size="4">
            <ion-item fill="outline" style="--border-radius: 12px; --padding-start: 8px;">
              <ion-label position="floating">Stock</ion-label>
              <ion-input type="number" [(ngModel)]="p.stock"></ion-input>
            </ion-item>
          </ion-col>

          <ion-col size="3">
            <ion-button (click)="guardarCambios(p)" expand="block" style="height: 100%; --border-radius: 12px;" color="primary">
              <ion-icon slot="icon-only" name="save-outline"></ion-icon>
            </ion-button>
          </ion-col>
        </ion-row>
      </ion-card-content>
    </ion-card>
  </ion-list>

  <ion-fab vertical="bottom" horizontal="end" slot="fixed">
    <ion-fab-button (click)="agregarProducto()" color="success">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>
</ion-content>